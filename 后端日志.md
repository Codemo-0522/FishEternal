2026-01-07 07:22:44,441 - app.config - INFO - æ­£åœ¨åŠ è½½é…ç½®...
2026-01-07 07:22:44,442 - app.config - INFO - å½“å‰å·¥ä½œç›®å½•: C:\Users\Administrator\Desktop\FishEternal\backend
2026-01-07 07:22:45,013 - app.utils.auth - INFO - å¯†ç å“ˆå¸Œç®—æ³•: sha256
2026-01-07 07:22:47,612 - app.mcp.manager - INFO - ğŸ¯ MCP Manager å·²åˆ›å»º
2026-01-07 07:22:47,623 - app.utils.llm.tool_config - INFO - ğŸ“‹ å·²ä»ç¯å¢ƒå˜é‡åŠ è½½é…ç½®: {'max_iterations': 10, 'tool_execution_timeout': 600, 'llm_call_timeout': 180, 'total_timeout': 900, 'max_concurrent_tools': 5, 'max_retries': 2, 'retry_delay': 1.0, 'enable_tool_cache': True, 'verbose_logging': True, 'force_reply_on_max_iterations': True, 'enable_tool_stats': True, 'max_tool_result_size': 1048576, 'allow_continue_on_error': True}
2026-01-07 07:22:47,759 - app.services.email_service - INFO - é‚®ç®±éªŒè¯åŠŸèƒ½å·²å…³é—­
2026-01-07 07:22:48,044 - app.services.chunking.registry - INFO - Registered chunker: simple -> SimpleChunker
2026-01-07 07:22:48,047 - app.services.chunking.registry - INFO - Registered chunker: json -> JSONChunker
2026-01-07 07:22:48,049 - app.services.chunking.registry - INFO - Registered chunker: code -> CodeChunker
2026-01-07 07:22:48,051 - app.services.chunking.registry - INFO - Registered chunker: markdown -> MarkdownChunker
2026-01-07 07:22:48,054 - app.services.chunking.registry - INFO - Registered chunker: semantic -> SemanticChunker
2026-01-07 07:22:49,863 - app.database - INFO - å¼€å§‹æ£€æŸ¥å’Œåˆå§‹åŒ–æ•°æ®åº“ç´¢å¼•...
2026-01-07 07:22:49,898 - app.database - INFO - åˆ›å»ºç´¢å¼•: [('users', 'account_1'), ('users', 'email_1'), ('chat_sessions', 'user_id_1'), ('chat_sessions', 'create_time_1'), ('model_capabilities', 'model_name_1'), ('model_capabilities', 'supports_tools_1'), ('user_tool_configs', 'user_id_1'), ('knowledge_bases', 'user_id_1'), ('knowledge_bases', 'created_at_1'), ('kb_documents', 'kb_id_1'), ('kb_documents', 'status_1'), ('kb_documents', 'created_at_1')]
2026-01-07 07:22:49,899 - app.main - INFO - ğŸš€ æ­£åœ¨åˆå§‹åŒ–å¼‚æ­¥ä»»åŠ¡å¤„ç†å™¨...
2026-01-07 07:22:49,903 - app.services.async_task_processor - INFO - ä»»åŠ¡å¤„ç†å™¨åˆå§‹åŒ–: max_concurrent=10, max_queue=1000
2026-01-07 07:22:49,903 - app.services.async_task_processor - INFO - ä»»åŠ¡å¤„ç†å™¨å·²å¯åŠ¨ï¼Œ10 ä¸ªå·¥ä½œåç¨‹
2026-01-07 07:22:49,904 - app.services.async_task_processor - INFO - å…¨å±€ä»»åŠ¡å¤„ç†å™¨å·²å¯åŠ¨
2026-01-07 07:22:49,904 - app.main - INFO - âœ… å¼‚æ­¥ä»»åŠ¡å¤„ç†å™¨å·²å¯åŠ¨
2026-01-07 07:23:09,473 - app.main - INFO - âœ“ å·²åœ¨ä¸»çº¿ç¨‹é¢„åŠ è½½ sentence_transformers
2026-01-07 07:23:09,499 - app.utils.embedding.vector_store - INFO - åå°é¢„åŠ è½½ ChromaDB å¼€å§‹...
2026-01-07 07:23:09,500 - app.utils.embedding.vector_store - INFO - åå°é¢„åŠ è½½ FAISS å¼€å§‹...
2026-01-07 07:23:09,864 - app.utils.embedding.vector_store - INFO - âœ“ FAISS é¢„åŠ è½½æˆåŠŸ (langchain_community)
2026-01-07 07:23:10,905 - app.utils.embedding.task_queue - INFO - ä»»åŠ¡é˜Ÿåˆ—å·²å¯åŠ¨ï¼Œå·¥ä½œçº¿ç¨‹æ•°: 4
2026-01-07 07:23:10,905 - app.utils.embedding.task_handlers - INFO - ä»»åŠ¡å¤„ç†å™¨åˆå§‹åŒ–å®Œæˆ
2026-01-07 07:23:10,906 - app.main - INFO - âœ… ä¼ä¸šçº§ä»»åŠ¡é˜Ÿåˆ—ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ
2026-01-07 07:23:11,578 - app.main - INFO - ğŸ”§ æ­£åœ¨åˆå§‹åŒ– Redis å®¢æˆ·ç«¯...
2026-01-07 07:23:11,581 - app.services.async_task_processor - INFO - worker-0 å·²å¯åŠ¨
2026-01-07 07:23:11,582 - app.services.async_task_processor - INFO - worker-1 å·²å¯åŠ¨
2026-01-07 07:23:11,583 - app.services.async_task_processor - INFO - worker-2 å·²å¯åŠ¨
2026-01-07 07:23:11,583 - app.services.async_task_processor - INFO - worker-3 å·²å¯åŠ¨
2026-01-07 07:23:11,590 - app.services.async_task_processor - INFO - worker-4 å·²å¯åŠ¨
2026-01-07 07:23:11,591 - app.services.async_task_processor - INFO - worker-5 å·²å¯åŠ¨
2026-01-07 07:23:11,591 - app.services.async_task_processor - INFO - worker-6 å·²å¯åŠ¨
2026-01-07 07:23:11,592 - app.services.async_task_processor - INFO - worker-7 å·²å¯åŠ¨
2026-01-07 07:23:11,592 - app.services.async_task_processor - INFO - worker-8 å·²å¯åŠ¨
2026-01-07 07:23:11,593 - app.services.async_task_processor - INFO - worker-9 å·²å¯åŠ¨
2026-01-07 07:23:11,594 - app.utils.embedding.task_queue - INFO - å·¥ä½œçº¿ç¨‹ worker-0 å·²å¯åŠ¨
2026-01-07 07:23:11,594 - app.services.embedding_manager - INFO - âœ… EmbeddingManager åˆå§‹åŒ–å®Œæˆ
2026-01-07 07:23:11,595 - app.utils.embedding.task_queue - INFO - å·¥ä½œçº¿ç¨‹ worker-1 å·²å¯åŠ¨
2026-01-07 07:23:11,596 - app.main - INFO - ğŸ§  å¼€å§‹é¢„åŠ è½½é»˜è®¤ Embedding æ¨¡å‹: checkpoints/embeddings/all-MiniLM-L6-v2
2026-01-07 07:23:11,596 - app.utils.embedding.task_queue - INFO - å·¥ä½œçº¿ç¨‹ worker-2 å·²å¯åŠ¨
2026-01-07 07:23:11,597 - app.services.embedding_manager - INFO - â³ å¼€å§‹åŠ è½½ Embedding æ¨¡å‹: EmbeddingKey(provider='local', model='checkpoints/embeddings/all-MiniLM-L6-v2', base_url=None)
2026-01-07 07:23:11,597 - app.utils.embedding.task_queue - INFO - å·¥ä½œçº¿ç¨‹ worker-3 å·²å¯åŠ¨
2026-01-07 07:23:11,607 - app.redis_client - INFO - âœ… Redisè¿æ¥æˆåŠŸ: localhost:6379 (DB: 0)
2026-01-07 07:23:11,608 - app.main - INFO - âœ… Redis å®¢æˆ·ç«¯åˆå§‹åŒ–å®Œæˆ
2026-01-07 07:23:11,615 - app.main - INFO - ğŸ§  æ­£åœ¨åˆå§‹åŒ–æ¨¡å‹èƒ½åŠ›ç®¡ç†å™¨...
2026-01-07 07:23:11,616 - app.utils.llm.model_capability_manager - INFO - ğŸ”„ æ­£åœ¨åˆå§‹åŒ–æ¨¡å‹èƒ½åŠ›ç®¡ç†å™¨...
2026-01-07 07:23:11,617 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: checkpoints/embeddings/all-MiniLM-L6-v2
2026-01-07 07:23:11,624 - app.utils.llm.model_capability_manager - INFO - âœ… å·²å°† 1 ä¸ªä¸æ”¯æŒå·¥å…·çš„æ¨¡å‹åŠ è½½åˆ°Redis
2026-01-07 07:23:11,627 - app.utils.llm.model_capability_manager - INFO - âœ… æ¨¡å‹èƒ½åŠ›ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ
2026-01-07 07:23:11,641 - app.main - INFO - âœ… æ¨¡å‹èƒ½åŠ›ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ
2026-01-07 07:23:11,642 - app.main - INFO - ğŸ”§ æ­£åœ¨åˆå§‹åŒ– MCP å·¥å…·ç³»ç»Ÿ...
2026-01-07 07:23:11,645 - app.mcp.manager - INFO - ğŸš€ ä½¿ç”¨è¿›ç¨‹å†… MCP Client
2026-01-07 07:23:11,645 - app.mcp.client - INFO - âœ… è¿›ç¨‹å†… MCP Client å·²åˆå§‹åŒ–
2026-01-07 07:23:11,646 - app.mcp.client - INFO - ğŸ“‹ å·²ç”Ÿæˆ 0 ä¸ªå¯ç”¨å·¥å…·ï¼ˆè¿‡æ»¤åï¼‰
2026-01-07 07:23:11,646 - app.mcp.manager - INFO - âœ… MCP Client å·²å¯åŠ¨ï¼ŒåŠ è½½äº† 0 ä¸ªå·¥å…·
2026-01-07 07:23:11,646 - app.main - INFO - âœ… MCP å·¥å…·ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ
2026-01-07 07:23:12,583 - app.services.embedding_manager - INFO - âœ… Embedding æ¨¡å‹åŠ è½½æˆåŠŸ: EmbeddingKey(provider='local', model='checkpoints/embeddings/all-MiniLM-L6-v2', base_url=None)
2026-01-07 07:23:12,584 - app.services.embedding_manager - INFO - ğŸ“Š å½“å‰å·²åŠ è½½æ¨¡å‹æ•°é‡: 1
2026-01-07 07:23:12,584 - app.main - INFO - âœ… é»˜è®¤ Embedding æ¨¡å‹é¢„åŠ è½½å®Œæˆ
2026-01-07 07:23:12,741 - app.utils.embedding.vector_store - INFO - âœ“ ChromaDB é¢„åŠ è½½æˆåŠŸ (langchain-chroma)
2026-01-07 07:23:12,767 - app.main - INFO - ğŸ“ æ­£åœ¨åˆå§‹åŒ–æœ‹å‹åœˆå‘å¸ƒå™¨...
2026-01-07 07:23:12,785 - app.services.moment_publisher - INFO - âœ… æœ‹å‹åœˆå‘å¸ƒå™¨å·²åˆå§‹åŒ–
2026-01-07 07:23:12,830 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2026-01-07 07:23:12,881 - apscheduler.scheduler - INFO - Added job "MomentPublisher.publish_pending_moments" to job store "default"
2026-01-07 07:23:12,881 - apscheduler.scheduler - INFO - Scheduler started
2026-01-07 07:23:12,882 - app.services.moment_publisher - INFO - âœ… æœ‹å‹åœˆå‘å¸ƒå™¨å·²å¯åŠ¨ï¼ˆæ£€æŸ¥é¢‘ç‡ï¼šæ¯ 1 åˆ†é’Ÿï¼‰
2026-01-07 07:23:12,884 - app.main - INFO - âœ… æœ‹å‹åœˆå‘å¸ƒå™¨å·²å¯åŠ¨
2026-01-07 07:23:12,895 - app.utils.auth - INFO - å¼€å§‹éªŒè¯token
2026-01-07 07:23:12,931 - app.utils.auth - INFO - Tokenä¸­çš„è´¦å·: aaa
2026-01-07 07:23:12,933 - app.utils.auth - INFO - å¼€å§‹éªŒè¯token
2026-01-07 07:23:12,934 - app.utils.auth - INFO - Tokenä¸­çš„è´¦å·: aaa
2026-01-07 07:23:12,946 - app.routers.chat - INFO - æ”¶åˆ°WebSocketè¿æ¥è¯·æ±‚ - ä¼šè¯ID: 47edb609-22b2-4d5b-b149-d1bbee42473d
2026-01-07 07:23:12,951 - app.routers.chat - INFO - WebSocketè¿æ¥å·²æ¥å—
2026-01-07 07:23:12,964 - app.utils.auth - INFO - æ‰¾åˆ°ç”¨æˆ·: aaa, id: 69580a6445120cfaaefb2675
2026-01-07 07:23:12,966 - app.utils.auth - INFO - æ‰¾åˆ°ç”¨æˆ·: aaa, id: 69580a6445120cfaaefb2675
2026-01-07 07:23:12,996 - app.routers.chat - INFO - æ”¶åˆ°è®¤è¯æ¶ˆæ¯
2026-01-07 07:23:12,998 - app.routers.chat - INFO - å¼€å§‹éªŒè¯token
2026-01-07 07:23:13,001 - app.routers.chat - INFO - ç”¨æˆ·è®¤è¯æˆåŠŸ: aaa, user_id: 69580a6445120cfaaefb2675
2026-01-07 07:23:13,009 - app.routers.chat - INFO - æ‰¾åˆ°ä¼šè¯: 47edb609-22b2-4d5b-b149-d1bbee42473d
2026-01-07 07:23:13,085 - app.services.embedding_manager - INFO - â³ å¼€å§‹åŠ è½½ Embedding æ¨¡å‹: EmbeddingKey(provider='ollama', model='nomic-embed-text:v1.5', base_url='http://localhost:11434')
2026-01-07 07:23:13,115 - app.services.embedding_manager - INFO - âœ… Embedding æ¨¡å‹åŠ è½½æˆåŠŸ: EmbeddingKey(provider='ollama', model='nomic-embed-text:v1.5', base_url='http://localhost:11434')
2026-01-07 07:23:13,116 - app.services.embedding_manager - INFO - ğŸ“Š å½“å‰å·²åŠ è½½æ¨¡å‹æ•°é‡: 2
2026-01-07 07:23:13,121 - app.services.vectorstore_manager - INFO - âœ… VectorStoreManager åˆå§‹åŒ–å®Œæˆ (é”æ–‡ä»¶ç›®å½•: data\locks)
2026-01-07 07:23:13,126 - app.services.vectorstore_manager - INFO - â³ åˆ›å»ºæ–°çš„ CHROMA VectorStore: default (è·ç¦»åº¦é‡: cosine)
2026-01-07 07:23:13,127 - app.utils.embedding.vector_store - INFO - ğŸ¯ ChromaVectorStore ä½¿ç”¨è·ç¦»åº¦é‡: cosine
2026-01-07 07:23:13,345 - chromadb.telemetry.product.posthog - INFO - Anonymized telemetry enabled. See                     https://docs.trychroma.com/telemetry for more information.
2026-01-07 07:23:13,696 - app.utils.embedding.vector_store - WARNING - âš ï¸ æœªæ‰¾åˆ°ä»»ä½•UUIDç›®å½•ï¼Œexpected: 322bb31c-3474-4c70-9620-66f999647131
2026-01-07 07:23:13,696 - app.services.vectorstore_manager - INFO - ğŸ”’ [å¤šè¿›ç¨‹é”] åˆå§‹åŒ–æ–‡ä»¶é”: C:\Users\Administrator\Desktop\FishEternal\backend\data\locks\chroma_default.lock
2026-01-07 07:23:13,697 - app.services.vectorstore_manager - INFO - âœ… CHROMA VectorStore åˆ›å»ºæˆåŠŸ: default
2026-01-07 07:23:13,697 - app.services.vectorstore_manager - INFO - ğŸ“Š å½“å‰ VectorStore è¿æ¥æ•°: 1
2026-01-07 07:23:13,698 - app.routers.chat - INFO - ğŸ“ å†å²å¼•ç”¨å±•å¼€: æ”¶é›†åˆ° 0 ä¸ªå”¯ä¸€ chunk_id
2026-01-07 07:23:13,699 - app.routers.chat - INFO - ğŸ“ å†å²å¼•ç”¨å±•å¼€: chunk_to_ref ç¤ºä¾‹: []
2026-01-07 07:23:13,699 - app.routers.chat - INFO - ğŸ“ å†å²å¼•ç”¨å±•å¼€: æ²¡æœ‰éœ€è¦å±•å¼€çš„å¼•ç”¨
2026-01-07 07:23:13,699 - app.routers.chat - INFO - å‘é€å†å²æ¶ˆæ¯ï¼ˆæ‡’åŠ è½½ï¼‰ï¼Œæ˜¾ç¤ºæœ€è¿‘20æ¡ï¼Œæ€»å…±50æ¡ï¼Œè¿˜æœ‰æ›´å¤š: True
2026-01-07 07:23:13,700 - app.routers.chat - INFO - ğŸ” ç¬¬ä¸€æ¡å†å²æ¶ˆæ¯çš„ timestamp: 2026-01-06T22:17:55.731042Z (ç±»å‹: <class 'str'>)
2026-01-07 07:23:13,703 - app.routers.chat - INFO - æ”¶åˆ°WebSocketæ¶ˆæ¯: {"type":"fetch_history","session_id":"47edb609-22b2-4d5b-b149-d1bbee42473d"}
2026-01-07 07:23:13,743 - app.mcp.registry - INFO - âœ… å·²æ³¨å†Œå·¥å…·: compress_context - å‹ç¼©ä¹‹å‰å·¥å…·è°ƒç”¨çš„è¿”å›ç»“æœï¼Œé‡Šæ”¾ä¸Šä¸‹æ–‡ç©ºé—´ã€‚å½“æ£€ç´¢åˆ°æ— å…³ä¿¡æ¯æˆ–å·²æå–å…³é”®ä¿¡æ¯åï¼Œå¯ä»¥ä½¿ç”¨æ­¤å·¥å…·å‹ç¼©åŸå§‹æ•°æ®ã€‚âš ï¸ é‡è¦ï¼šå‹ç¼©æ˜¯ä¸å¯é€†çš„ï¼Œå‹ç¼©ååŸå§‹æ•°æ®æ— æ³•æ¢å¤ï¼ˆéœ€è¦é‡æ–°è°ƒç”¨å·¥å…·è·å–ï¼‰ã€‚

ä½¿ç”¨åœºæ™¯ï¼š
1. mark_irrelevant - æ£€ç´¢åˆ°çš„å†…å®¹å®Œå…¨ä¸ç›¸å…³ï¼Œéœ€è¦é‡æ–°æ£€ç´¢
2. compress_to_summary - å·²æå–å…³é”®ä¿¡æ¯ï¼Œå¯ä»¥ç”¨æ‘˜è¦æ›¿ä»£è¯¦ç»†å†…å®¹
3. partial_compress - éƒ¨åˆ†å†…å®¹æœ‰ç”¨å·²æå–ï¼Œå…¶ä½™å¯ä»¥å‹ç¼©

âš ï¸ ä½¿ç”¨å»ºè®®ï¼š
- åœ¨ç¡®è®¤å†…å®¹æ— å…³æˆ–å·²å……åˆ†åˆ©ç”¨åå†å‹ç¼©
- ä¿ç•™æ‘˜è¦ä¿¡æ¯ï¼Œé¿å…åç»­é‡å¤æ£€ç´¢
- æ‰¹é‡å‹ç¼©å¤šä¸ªç»“æœæ—¶æ³¨æ„ä¸è¦è¯¯åˆ æœ‰ç”¨ä¿¡æ¯
2026-01-07 07:23:13,743 - app.mcp.tools - INFO - ğŸ“¦ å·²ä» compress_context.py åŠ è½½å·¥å…·: compress_context
2026-01-07 07:23:13,746 - app.mcp.tools.generate_image - INFO - ğŸš« å›¾ç‰‡ç”Ÿæˆå·¥å…·ä¸å¯ç”¨ - ç”¨æˆ·æœªé…ç½®ä»»ä½•æœåŠ¡å•†
2026-01-07 07:23:13,747 - app.mcp.registry - INFO - âœ… å·²æ³¨å†ŒåŠ¨æ€å·¥å…·: GenerateImageToolï¼ˆå·¥å…·åç§°å°†åœ¨è¿è¡Œæ—¶ç¡®å®šï¼‰
2026-01-07 07:23:13,747 - app.mcp.tools.generate_image - INFO - ğŸš« å›¾ç‰‡ç”Ÿæˆå·¥å…·ä¸å¯ç”¨ - ç”¨æˆ·æœªé…ç½®ä»»ä½•æœåŠ¡å•†
2026-01-07 07:23:13,747 - app.mcp.tools - INFO - ğŸ“¦ å·²ä» generate_image.py åŠ è½½å·¥å…·: GenerateImageTool
2026-01-07 07:23:13,750 - app.mcp.registry - INFO - âœ… å·²æ³¨å†Œå·¥å…·: get_moment_detail - ä½¿ç”¨è¯¥å·¥å…·å¯ä»¥è·å–æŒ‡å®šæœ‹å‹åœˆçš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ‰€æœ‰ç‚¹èµå’Œè¯„è®ºã€‚
2026-01-07 07:23:13,750 - app.mcp.tools - INFO - ğŸ“¦ å·²ä» get_moments.py åŠ è½½å·¥å…·: get_moment_detail
2026-01-07 07:23:13,751 - app.mcp.registry - INFO - âœ… å·²æ³¨å†Œå·¥å…·: get_my_moments - ä½¿ç”¨è¯¥å·¥å…·å¯ä»¥æŸ¥çœ‹ä½ è‡ªå·±å‘é€çš„æœ‹å‹åœˆï¼Œå¦‚æœæœ‰äººè¯„è®ºäº†ä½ ï¼Œä½ ä¸€èˆ¬ä¼šé€‰æ‹©å›å¤è¯„è®º
2026-01-07 07:23:13,751 - app.mcp.tools - INFO - ğŸ“¦ å·²ä» get_moments.py åŠ è½½å·¥å…·: get_my_moments
2026-01-07 07:23:13,754 - app.mcp.registry - INFO - âœ… å·²æ³¨å†Œå·¥å…·: get_user_info - ä½¿ç”¨è¯¥å·¥å…·å¯ä»¥æŸ¥çœ‹å½“å‰ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯ï¼Œä»¥ä¾¿äºä½ äº†è§£ç”¨æˆ·
2026-01-07 07:23:13,756 - app.mcp.tools - INFO - ğŸ“¦ å·²ä» get_user_info.py åŠ è½½å·¥å…·: get_user_info
2026-01-07 07:23:13,759 - app.mcp.registry - INFO - âœ… å·²æ³¨å†Œå·¥å…·: ai_go_offline - AIä»ç¾¤èŠä¸‹çº¿ã€‚å½“ä½ å†³å®šæš‚æ—¶é€€å‡ºç¾¤èŠæ—¶è°ƒç”¨æ­¤å·¥å…·ã€‚ä¸‹çº¿åä½ å°†ä¸å†æ”¶åˆ°ç¾¤èŠæ¶ˆæ¯ã€‚
2026-01-07 07:23:13,760 - app.mcp.tools - INFO - ğŸ“¦ å·²ä» group_chat_tools.py åŠ è½½å·¥å…·: ai_go_offline
2026-01-07 07:23:13,761 - app.mcp.registry - INFO - âœ… å·²æ³¨å†Œå·¥å…·: ai_go_online - AIä¸Šçº¿åˆ°ç¾¤èŠã€‚å½“ä½ å†³å®šå‚ä¸ç¾¤èŠæ—¶è°ƒç”¨æ­¤å·¥å…·ã€‚
2026-01-07 07:23:13,761 - app.mcp.tools - INFO - ğŸ“¦ å·²ä» group_chat_tools.py åŠ è½½å·¥å…·: ai_go_online
2026-01-07 07:23:13,761 - app.mcp.registry - INFO - âœ… å·²æ³¨å†Œå·¥å…·: check_online_status - æŸ¥è¯¢è‡ªå·±åœ¨ç¾¤èŠä¸­çš„åœ¨çº¿çŠ¶æ€
2026-01-07 07:23:13,762 - app.mcp.tools - INFO - ğŸ“¦ å·²ä» group_chat_tools.py åŠ è½½å·¥å…·: check_online_status
2026-01-07 07:23:13,762 - app.mcp.registry - INFO - âœ… å·²æ³¨å†Œå·¥å…·: get_group_info - è·å–ç¾¤èŠçš„å½“å‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬æˆå‘˜æ•°é‡ã€æœ€è¿‘æ¶ˆæ¯ç­‰ï¼Œç”¨äºå†³ç­–æ˜¯å¦ä¸Šçº¿
2026-01-07 07:23:13,763 - app.mcp.tools - INFO - ğŸ“¦ å·²ä» group_chat_tools.py åŠ è½½å·¥å…·: get_group_info
2026-01-07 07:23:13,766 - app.mcp.tools.knowledge_retrieval - INFO - ğŸš« çŸ¥è¯†åº“å·¥å…·ä¸å¯ç”¨ - kb_settingså­˜åœ¨: False, enabled: N/A
2026-01-07 07:23:13,766 - app.mcp.registry - INFO - âœ… å·²æ³¨å†ŒåŠ¨æ€å·¥å…·: KnowledgeRetrievalToolï¼ˆå·¥å…·åç§°å°†åœ¨è¿è¡Œæ—¶ç¡®å®šï¼‰
2026-01-07 07:23:13,767 - app.mcp.tools.knowledge_retrieval - INFO - ğŸš« çŸ¥è¯†åº“å·¥å…·ä¸å¯ç”¨ - kb_settingså­˜åœ¨: False, enabled: N/A
2026-01-07 07:23:13,768 - app.mcp.tools - INFO - ğŸ“¦ å·²ä» knowledge_retrieval.py åŠ è½½å·¥å…·: KnowledgeRetrievalTool
2026-01-07 07:23:13,772 - app.mcp.registry - INFO - âœ… å·²æ³¨å†Œå·¥å…·: cancel_moment - ä½¿ç”¨è¯¥å·¥å…·å¯ä»¥å–æ¶ˆä¸€æ¡ä½ è‡ªå·±å°šæœªå‘å¸ƒï¼ˆçŠ¶æ€ä¸º pendingï¼‰çš„æœ‹å‹åœˆã€‚
2026-01-07 07:23:13,773 - app.mcp.tools - INFO - ğŸ“¦ å·²ä» moment.py åŠ è½½å·¥å…·: cancel_moment
2026-01-07 07:23:13,773 - app.mcp.registry - INFO - âœ… å·²æ³¨å†Œå·¥å…·: comment_moment - ä½¿ç”¨è¯¥å·¥å…·å¯ä»¥å¯¹ä½ è‡ªå·±å‘å¸ƒçš„æœ‹å‹åœˆæ·»åŠ è¯„è®ºã€‚ç”¨æˆ·ä¼šåœ¨å‰ç«¯çœ‹åˆ°ä½ çš„æœ‹å‹åœˆï¼Œå¹¶å¯èƒ½å¯¹å…¶è¿›è¡Œè¯„è®ºï¼Œè¿™ä¸ªå·¥å…·ç”¨äºæŸ¥çœ‹å’Œå›å¤ç”¨æˆ·çš„è¯„è®ºã€‚
2026-01-07 07:23:13,774 - app.mcp.tools - INFO - ğŸ“¦ å·²ä» moment.py åŠ è½½å·¥å…·: comment_moment
2026-01-07 07:23:13,775 - app.mcp.registry - INFO - âœ… å·²æ³¨å†Œå·¥å…·: like_moment - ä½¿ç”¨è¯¥å·¥å…·å¯ä»¥ç»™ä½ è‡ªå·±çš„æœ‹å‹åœˆè¿›è¡Œç‚¹èµæˆ–å–æ¶ˆç‚¹èµã€‚
2026-01-07 07:23:13,776 - app.mcp.tools - INFO - ğŸ“¦ å·²ä» moment.py åŠ è½½å·¥å…·: like_moment
2026-01-07 07:23:13,777 - app.mcp.registry - INFO - âœ… å·²æ³¨å†Œå·¥å…·: schedule_moment - ä½¿ç”¨è¯¥å·¥å…·å¯ä»¥è®©ä½ æ‰€æ‰®æ¼”çš„è§’è‰²æˆ–è€…ä½œä¸ºå¤§æ¨¡å‹æœ¬è´¨çš„ä½ å‘å¸ƒè‡ªå·±çš„æœ‹å‹åœˆå†…å®¹ï¼ˆæ³¨æ„ï¼šè¿™æ˜¯ä½ è‡ªå·±çš„æœ‹å‹åœˆï¼Œä¸æ˜¯ç”¨æˆ·çš„æœ‹å‹åœˆï¼‰ã€‚
2026-01-07 07:23:13,777 - app.mcp.tools - INFO - ğŸ“¦ å·²ä» moment.py åŠ è½½å·¥å…·: schedule_moment
2026-01-07 07:23:13,780 - app.mcp.registry - INFO - âœ… å·²æ³¨å†Œå·¥å…·: skip_reply - âš ï¸ è°¨æ…ä½¿ç”¨ï¼å½“ä½ çœŸçš„ç¡®å®šä¸éœ€è¦å›å¤æ—¶æ‰è°ƒç”¨æ­¤å·¥å…·ã€‚é€‚ç”¨åœºæ™¯ï¼ˆå¿…é¡»æ»¡è¶³è‡³å°‘ä¸€æ¡ï¼‰ï¼š1. æ¶ˆæ¯å®Œå…¨ä¸ºç©ºæˆ–æ— ä»»ä½•å®é™…å†…å®¹2. è¯é¢˜å®Œå…¨ä¸ä½ æ— å…³ï¼Œä¸”ä½ æ²¡æœ‰ä»»ä½•æƒ³æ³•æˆ–è¯„è®º3. å…¶ä»–äººå·²ç»å®Œæ•´å›ç­”ï¼Œä¸”ä½ å®Œå…¨æ²¡æœ‰æ–°è§è§£å¯ä»¥è¡¥å……4. æ˜æ˜¾çš„åˆ·å±æˆ–åƒåœ¾æ¶ˆæ¯â›” ä¸è¦åœ¨ä»¥ä¸‹æƒ…å†µä½¿ç”¨ï¼š- ä½ è¢« @ æåŠï¼ˆè¢«@å¿…é¡»å›å¤ï¼ï¼‰- è¯é¢˜ç¨å¾®ç›¸å…³æˆ–æœ‰è¶£ï¼ˆåº”è¯¥å‚ä¸è®¨è®ºï¼‰- ä½ æœ‰ä»»ä½•æƒ³æ³•ã€è¯„è®ºã€è¡¨æƒ…å¯ä»¥åˆ†äº«- åªæ˜¯å› ä¸ºä¸ç¡®å®šè¯´ä»€ä¹ˆï¼ˆå¯ä»¥è¯´ç‚¹è½»æ¾çš„è¯ï¼‰
2026-01-07 07:23:13,781 - app.mcp.tools - INFO - ğŸ“¦ å·²ä» skip_reply.py åŠ è½½å·¥å…·: skip_reply
2026-01-07 07:23:13,783 - app.mcp.registry - INFO - âœ… å·²æ³¨å†Œå·¥å…·: get_current_time - ä½¿ç”¨è¯¥å·¥å…·å¯ä»¥è·å–å½“å‰ç³»ç»Ÿæ—¶é—´
2026-01-07 07:23:13,784 - app.mcp.tools - INFO - ğŸ“¦ å·²ä» system_time.py åŠ è½½å·¥å…·: get_current_time
2026-01-07 07:23:13,784 - app.mcp.tools - INFO - ğŸš€ MCP å·¥å…·åŠ è½½å®Œæˆï¼Œå…±æ³¨å†Œ 16 ä¸ªå·¥å…·
2026-01-07 07:23:13,785 - app.mcp.tools.knowledge_retrieval - INFO - ğŸ”„ å·²é‡ç½®ä¼šè¯ 47edb609-22b2-4d5b-b149-d1bbee42473d çš„å…¨å±€å¼•ç”¨åºå·
2026-01-07 07:23:13,785 - app.routers.chat - INFO - æœªæ”¶åˆ°ä¼šè¯ç‰¹å®šçš„æ¨¡å‹é…ç½®ï¼Œå°†ä½¿ç”¨ç³»ç»Ÿé»˜è®¤é…ç½®
2026-01-07 07:23:13,786 - app.routers.chat - WARNING - æ”¶åˆ°ç©ºæ¶ˆæ¯ä¸”æ— å›¾ç‰‡
2026-01-07 07:23:13,791 - app.utils.auth - INFO - å¼€å§‹éªŒè¯token
2026-01-07 07:23:13,792 - app.utils.auth - INFO - Tokenä¸­çš„è´¦å·: aaa
2026-01-07 07:23:13,793 - app.utils.auth - INFO - å¼€å§‹éªŒè¯token
2026-01-07 07:23:13,794 - app.utils.auth - INFO - Tokenä¸­çš„è´¦å·: aaa
2026-01-07 07:23:13,796 - app.utils.auth - INFO - æ‰¾åˆ°ç”¨æˆ·: aaa, id: 69580a6445120cfaaefb2675
2026-01-07 07:23:13,823 - app.utils.auth - INFO - æ‰¾åˆ°ç”¨æˆ·: aaa, id: 69580a6445120cfaaefb2675
2026-01-07 07:23:24,605 - app.utils.auth - INFO - å¼€å§‹éªŒè¯token
2026-01-07 07:23:24,606 - app.utils.auth - INFO - Tokenä¸­çš„è´¦å·: aaa
2026-01-07 07:23:24,609 - app.utils.auth - INFO - å¼€å§‹éªŒè¯token
2026-01-07 07:23:24,609 - app.utils.auth - INFO - Tokenä¸­çš„è´¦å·: aaa
2026-01-07 07:23:24,611 - app.utils.auth - INFO - æ‰¾åˆ°ç”¨æˆ·: aaa, id: 69580a6445120cfaaefb2675
2026-01-07 07:23:24,613 - app.utils.auth - INFO - æ‰¾åˆ°ç”¨æˆ·: aaa, id: 69580a6445120cfaaefb2675
2026-01-07 07:23:38,916 - app.routers.chat - INFO - æ”¶åˆ°WebSocketæ¶ˆæ¯: {"type":"ping","ts":1767741818915}
2026-01-07 07:23:53,933 - app.utils.auth - INFO - å¼€å§‹éªŒè¯token
2026-01-07 07:23:53,934 - app.utils.auth - INFO - Tokenä¸­çš„è´¦å·: aaa
2026-01-07 07:23:53,936 - app.utils.auth - INFO - æ‰¾åˆ°ç”¨æˆ·: aaa, id: 69580a6445120cfaaefb2675
2026-01-07 07:23:54,564 - app.utils.auth - INFO - å¼€å§‹éªŒè¯token
2026-01-07 07:23:54,565 - app.utils.auth - INFO - Tokenä¸­çš„è´¦å·: aaa
2026-01-07 07:23:54,568 - app.utils.auth - INFO - æ‰¾åˆ°ç”¨æˆ·: aaa, id: 69580a6445120cfaaefb2675
2026-01-07 07:24:01,871 - app.utils.auth - INFO - å¼€å§‹éªŒè¯token
2026-01-07 07:24:01,872 - app.utils.auth - INFO - Tokenä¸­çš„è´¦å·: aaa
2026-01-07 07:24:01,878 - app.utils.auth - INFO - æ‰¾åˆ°ç”¨æˆ·: aaa, id: 69580a6445120cfaaefb2675
2026-01-07 07:24:01,879 - app.routers.chat - INFO - å¼€å§‹è·å–ä¼šè¯åˆ—è¡¨ - ç”¨æˆ·ID: 69580a6445120cfaaefb2675
2026-01-07 07:24:01,884 - app.routers.chat - INFO - æˆåŠŸè·å–ä¼šè¯åˆ—è¡¨ - æ•°é‡: 2
2026-01-07 07:24:02,535 - app.utils.auth - INFO - å¼€å§‹éªŒè¯token
2026-01-07 07:24:02,536 - app.utils.auth - INFO - Tokenä¸­çš„è´¦å·: aaa
2026-01-07 07:24:02,538 - app.utils.auth - INFO - æ‰¾åˆ°ç”¨æˆ·: aaa, id: 69580a6445120cfaaefb2675
2026-01-07 07:24:02,539 - app.routers.chat - INFO - å¼€å§‹è·å–ä¼šè¯åˆ—è¡¨ - ç”¨æˆ·ID: 69580a6445120cfaaefb2675
2026-01-07 07:24:02,542 - app.routers.chat - INFO - æˆåŠŸè·å–ä¼šè¯åˆ—è¡¨ - æ•°é‡: 2
2026-01-07 07:24:02,781 - app.utils.auth - INFO - å¼€å§‹éªŒè¯token
2026-01-07 07:24:02,784 - app.utils.auth - INFO - Tokenä¸­çš„è´¦å·: aaa
2026-01-07 07:24:02,793 - app.utils.auth - INFO - æ‰¾åˆ°ç”¨æˆ·: aaa, id: 69580a6445120cfaaefb2675
2026-01-07 07:24:02,795 - app.services.group_chat.conversation_controller - INFO - âœ… å¯¹è¯æ§åˆ¶å™¨å·²åˆå§‹åŒ– | é…ç½®: {'max_ai_consecutive_replies': 3, 'max_messages_per_round': 20, 'max_tokens_per_round': 50000, 'cooldown_seconds': 30, 'enable_ai_to_ai': True, 'ai_reply_probability': 0.6, 'recovery_callback': <bound method GroupChatService._on_cooldown_recovery of <app.services.group_chat.group_chat_service.GroupChatService object at 0x000001801D9D9A50>>}
2026-01-07 07:24:03,449 - app.utils.auth - INFO - å¼€å§‹éªŒè¯token
2026-01-07 07:24:03,454 - app.utils.auth - INFO - Tokenä¸­çš„è´¦å·: aaa
2026-01-07 07:24:03,460 - app.utils.auth - INFO - æ‰¾åˆ°ç”¨æˆ·: aaa, id: 69580a6445120cfaaefb2675
2026-01-07 07:24:03,461 - app.services.group_chat.conversation_controller - INFO - âœ… å¯¹è¯æ§åˆ¶å™¨å·²åˆå§‹åŒ– | é…ç½®: {'max_ai_consecutive_replies': 3, 'max_messages_per_round': 20, 'max_tokens_per_round': 50000, 'cooldown_seconds': 30, 'enable_ai_to_ai': True, 'ai_reply_probability': 0.6, 'recovery_callback': <bound method GroupChatService._on_cooldown_recovery of <app.services.group_chat.group_chat_service.GroupChatService object at 0x000001801DBA5890>>}
2026-01-07 07:24:03,671 - app.routers.chat - INFO - æ”¶åˆ°WebSocketæ¶ˆæ¯: {"type":"ping","ts":1767741843670}
2026-01-07 07:24:12,836 - apscheduler.executors.default - INFO - Running job "MomentPublisher.publish_pending_moments (trigger: interval[0:01:00], next run at: 2026-01-07 07:25:12 CST)" (scheduled at 2026-01-07 07:24:12.830776+08:00)
2026-01-07 07:24:12,840 - apscheduler.executors.default - INFO - Job "MomentPublisher.publish_pending_moments (trigger: interval[0:01:00], next run at: 2026-01-07 07:25:12 CST)" executed successfully
2026-01-07 07:24:18,270 - app.utils.auth - INFO - å¼€å§‹éªŒè¯token
2026-01-07 07:24:18,271 - app.utils.auth - INFO - Tokenä¸­çš„è´¦å·: aaa
2026-01-07 07:24:18,277 - app.utils.auth - INFO - æ‰¾åˆ°ç”¨æˆ·: aaa, id: 69580a6445120cfaaefb2675
2026-01-07 07:24:18,282 - app.routers.chat - INFO - ğŸ—‘ï¸ æ¸…ç©ºä¼šè¯æ‰€æœ‰æ¶ˆæ¯ - ä¼šè¯ID: 47edb609-22b2-4d5b-b149-d1bbee42473d, æ¶ˆæ¯æ•°é‡: 50
2026-01-07 07:24:18,324 - app.utils.minio_client - INFO - å›¾ç‰‡åˆ é™¤æˆåŠŸ: users/69580a6445120cfaaefb2675/47edb609-22b2-4d5b-b149-d1bbee42473d/ai_generated_image_0/db929db8-780c-4d78-8122-b6a321773501.jpg
2026-01-07 07:24:18,336 - app.utils.minio_client - INFO - å›¾ç‰‡åˆ é™¤æˆåŠŸ: users/69580a6445120cfaaefb2675/47edb609-22b2-4d5b-b149-d1bbee42473d/ai_generated_image_0/bce68d48-d26b-4161-b2ad-13ced5648c3c.jpg
2026-01-07 07:24:18,343 - app.utils.minio_client - INFO - å›¾ç‰‡åˆ é™¤æˆåŠŸ: users/69580a6445120cfaaefb2675/47edb609-22b2-4d5b-b149-d1bbee42473d/ai_generated_image_0/86030b45-6557-4db0-bb42-17aca7ba026f.jpg
2026-01-07 07:24:18,357 - app.utils.minio_client - INFO - å›¾ç‰‡åˆ é™¤æˆåŠŸ: users/69580a6445120cfaaefb2675/47edb609-22b2-4d5b-b149-d1bbee42473d/47edb609-22b2-4d5b-b149-d1bbee42473d_8/94c927db-1af6-4c0f-978b-12e9d07484b6.jpg
2026-01-07 07:24:18,371 - app.utils.minio_client - INFO - å›¾ç‰‡åˆ é™¤æˆåŠŸ: users/69580a6445120cfaaefb2675/47edb609-22b2-4d5b-b149-d1bbee42473d/ai_generated_image_0/1445f22b-3386-427c-822d-d3ec996572e6.jpg
2026-01-07 07:24:18,371 - app.routers.chat - INFO - ä»ç´¢å¼• -1 ä¹‹ååˆ é™¤æ¶ˆæ¯ä¸­çš„ MinIO å›¾ç‰‡æ€»æ•°: 5
2026-01-07 07:24:27,982 - app.routers.chat - INFO - æ”¶åˆ°WebSocketæ¶ˆæ¯: {"type":"ping","ts":1767741867982}
2026-01-07 07:24:42,040 - app.utils.auth - INFO - å¼€å§‹éªŒè¯token
2026-01-07 07:24:42,040 - app.utils.auth - INFO - Tokenä¸­çš„è´¦å·: aaa
2026-01-07 07:24:42,048 - app.utils.auth - INFO - æ‰¾åˆ°ç”¨æˆ·: aaa, id: 69580a6445120cfaaefb2675
2026-01-07 07:24:48,121 - app.utils.auth - INFO - å¼€å§‹éªŒè¯token
2026-01-07 07:24:48,122 - app.utils.auth - INFO - Tokenä¸­çš„è´¦å·: aaa
2026-01-07 07:24:48,130 - app.utils.auth - INFO - æ‰¾åˆ°ç”¨æˆ·: aaa, id: 69580a6445120cfaaefb2675
2026-01-07 07:24:48,131 - app.routers.chat - INFO - æ›´æ–°ä¼šè¯è¯·æ±‚ - ä¼šè¯ID: 47edb609-22b2-4d5b-b149-d1bbee42473d, ç”¨æˆ·ID: 69580a6445120cfaaefb2675
2026-01-07 07:24:48,142 - app.routers.chat - INFO - ä¼šè¯æ›´æ–°æˆåŠŸ: 47edb609-22b2-4d5b-b149-d1bbee42473d
2026-01-07 07:24:48,376 - app.utils.auth - INFO - å¼€å§‹éªŒè¯token
2026-01-07 07:24:48,378 - app.utils.auth - INFO - Tokenä¸­çš„è´¦å·: aaa
2026-01-07 07:24:48,389 - app.utils.auth - INFO - æ‰¾åˆ°ç”¨æˆ·: aaa, id: 69580a6445120cfaaefb2675
2026-01-07 07:24:48,389 - app.routers.chat - INFO - å¼€å§‹è·å–ä¼šè¯åˆ—è¡¨ - ç”¨æˆ·ID: 69580a6445120cfaaefb2675
2026-01-07 07:24:48,396 - app.routers.chat - INFO - æˆåŠŸè·å–ä¼šè¯åˆ—è¡¨ - æ•°é‡: 2
2026-01-07 07:24:52,971 - app.routers.chat - INFO - æ”¶åˆ°WebSocketæ¶ˆæ¯: {"type":"ping","ts":1767741892970}
2026-01-07 07:25:12,835 - apscheduler.executors.default - INFO - Running job "MomentPublisher.publish_pending_moments (trigger: interval[0:01:00], next run at: 2026-01-07 07:26:12 CST)" (scheduled at 2026-01-07 07:25:12.830776+08:00)
2026-01-07 07:25:12,839 - apscheduler.executors.default - INFO - Job "MomentPublisher.publish_pending_moments (trigger: interval[0:01:00], next run at: 2026-01-07 07:26:12 CST)" executed successfully
2026-01-07 07:25:17,968 - app.routers.chat - INFO - æ”¶åˆ°WebSocketæ¶ˆæ¯: {"type":"ping","ts":1767741917967}
2026-01-07 07:25:30,482 - app.routers.chat - INFO - æ”¶åˆ°WebSocketæ¶ˆæ¯: {"message":"è¯·å‘å¸ƒä¸€æ¡å¸¦å›¾ï¼ˆå›¾ç‰‡æ¯”ä¾‹1:1çš„å°å…”å­ï¼‰æœ‹å‹åœˆï¼Œè®¾ç½®ä¸ºç«‹å³å‘å¸ƒ","images":[],"session_id":"47edb609-22b2-4d5b-b149-d1bbee42473d","model_settings":{"modelService":"modelscope","baseUrl":"https://api-inference.modelscope.cn/v1","apiKey":"ms-8b919327-58b1-4dd4-8292-72f064a8797f","modelName":"XiaomiMiMo/MiMo-V2-Flash","modelParams":{"temperature":1,"top_p":0.85,"max_tokens":4096}},"enable_voice":false,"enable_text_cleaning":true,"text_cleaning_patterns":"\\([^)]*\\)\nï¼ˆ[^ï¼‰]*ï¼‰\n\\[[^\\]]*\\]\nã€[^ã€‘]*ã€‘\n\\{[^}]*\\}\n<[^>]*>\n\\*[^*]*\\*","preserve_quotes":true,"kb_settings":{"enabled":false,"kb_prompt_template":"","kb_ids":["695d87532d42f94d5292a298"]}}
2026-01-07 07:25:30,483 - app.mcp.tools.knowledge_retrieval - INFO - ğŸ”„ å·²é‡ç½®ä¼šè¯ 47edb609-22b2-4d5b-b149-d1bbee42473d çš„å…¨å±€å¼•ç”¨åºå·
2026-01-07 07:25:30,490 - app.routers.chat - INFO - æ”¶åˆ°ä¼šè¯ç‰¹å®šçš„æ¨¡å‹é…ç½®:
2026-01-07 07:25:30,490 - app.routers.chat - INFO - - æ¨¡å‹æœåŠ¡: modelscope
2026-01-07 07:25:30,491 - app.routers.chat - INFO - - åŸºç¡€URL: https://api-inference.modelscope.cn/v1
2026-01-07 07:25:30,492 - app.routers.chat - INFO - - æ¨¡å‹åç§°: XiaomiMiMo/MiMo-V2-Flash
2026-01-07 07:25:30,492 - app.routers.chat - INFO - - APIå¯†é’¥: å·²æä¾›
2026-01-07 07:25:30,493 - app.routers.chat - INFO - å¼€å§‹ç”ŸæˆAIå›å¤
2026-01-07 07:25:30,495 - app.routers.chat - INFO - ä½¿ç”¨ä¼šè¯çš„system_prompt: 
2026-01-07 07:25:30,498 - app.routers.chat - INFO - ä½¿ç”¨ä¸Šä¸‹æ–‡æ•°é‡: 20
2026-01-07 07:25:30,501 - app.routers.chat - INFO - è·å–åˆ°å†å²æ¶ˆæ¯æ•°é‡: 0
2026-01-07 07:25:30,502 - app.routers.chat - INFO - å†å²æ¶ˆæ¯å·²è¿‡æ»¤ï¼Œç§»é™¤æ·±åº¦æ€è€ƒå†…å®¹ç”¨äºä¸Šä¸‹æ–‡ä¼ é€’
2026-01-07 07:25:30,505 - app.routers.chat - INFO - ä¼šè¯æœªå¯ç”¨çŸ¥è¯†åº“ï¼Œè·³è¿‡æ£€ç´¢
2026-01-07 07:25:30,507 - app.routers.chat - INFO - ğŸ” æœ¬åœ°RAG - kb_settingså­˜åœ¨: False, vectorstoreå­˜åœ¨: False
2026-01-07 07:25:30,508 - app.routers.chat - INFO - âš ï¸ ä¼šè¯æœªå¯ç”¨æœ¬åœ°RAGçŸ¥è¯†åº“æˆ–å‘é‡å­˜å‚¨æœªæ„å»º
2026-01-07 07:25:30,508 - app.utils.llm.streaming_manager - INFO - âœ… æ¸…ç†ä»»åŠ¡å·²å¯åŠ¨
2026-01-07 07:25:30,509 - app.utils.llm.streaming_manager - INFO - ğŸ”— æ³¨å†Œæµå¼ä¼šè¯: 47edb609-22b2-4d5b-b149-d1bbee42473d (ç”¨æˆ·: 69580a6445120cfaaefb2675)
2026-01-07 07:25:30,511 - app.utils.llm.streaming_manager - INFO - ğŸ”§ å·¥å…·è°ƒç”¨æœ€å¤§è¿­ä»£æ¬¡æ•°: 10 (å…¨å±€é…ç½®: 10)
2026-01-07 07:25:30,602 - app.mcp.client - INFO - ğŸ”§ å·²åŠ è½½ä¼šè¯ 47edb609-22b2-4d5b-b149-d1bbee42473d çš„ kb_settings: {'enabled': False, 'kb_prompt_template': '', 'kb_ids': ['695d87532d42f94d5292a298']}
2026-01-07 07:25:30,604 - app.mcp.client - INFO - ğŸ” å¼€å§‹æŸ¥è¯¢ç”¨æˆ·å›¾ç‰‡ç”Ÿæˆé…ç½®: user_id=69580a6445120cfaaefb2675 (ObjectId: 69580a6445120cfaaefb2675), db_name=fish_chat
2026-01-07 07:25:30,607 - app.mcp.client - INFO - ğŸ” æŸ¥è¯¢ç»“æœ: user_dataå­˜åœ¨=True
2026-01-07 07:25:30,607 - app.mcp.client - INFO - ğŸ” åŸå§‹é…ç½®æ•°é‡: 1, é…ç½®keys: ['modelscope']
2026-01-07 07:25:30,607 - app.mcp.client - INFO - ğŸ” å¯ç”¨çš„é…ç½®æ•°é‡: 1
2026-01-07 07:25:30,608 - app.mcp.client - INFO - ğŸ” é»˜è®¤æœåŠ¡å•†: modelscope
2026-01-07 07:25:30,608 - app.mcp.client - INFO - ğŸ¨ å·²åŠ è½½ç”¨æˆ· 69580a6445120cfaaefb2675 çš„å›¾ç‰‡ç”Ÿæˆé…ç½®: 1 ä¸ªæœåŠ¡å•†
2026-01-07 07:25:30,609 - app.mcp.tools.knowledge_retrieval - INFO - ğŸš« çŸ¥è¯†åº“å·¥å…·ä¸å¯ç”¨ - kb_settingså­˜åœ¨: True, enabled: False
2026-01-07 07:25:30,613 - app.mcp.client - INFO - ğŸ” å·²æ ¹æ®ç”¨æˆ· 69580a6445120cfaaefb2675 çš„é…ç½®è¿‡æ»¤å·¥å…·: 6 ä¸ªå¯ç”¨
2026-01-07 07:25:30,614 - app.mcp.client - INFO - ğŸ“‹ å·²ç”Ÿæˆ 6 ä¸ªå¯ç”¨å·¥å…·ï¼ˆè¿‡æ»¤åï¼‰
2026-01-07 07:25:30,614 - app.utils.llm.streaming_manager - INFO - ğŸ”„ å·¥å…·è°ƒç”¨è¿­ä»£ 1/10 (å·²ç”¨æ—¶: 0.0ç§’/900ç§’)
2026-01-07 07:25:30,614 - app.utils.llm.streaming_manager - INFO - ğŸ” è¿­ä»£ 1 å¼€å§‹ï¼Œlast_iteration_had_tool_calls=False
2026-01-07 07:25:30,615 - app.utils.llm.streaming_manager - INFO - ğŸ”§ çœŸæµå¼å·¥å…·è°ƒç”¨ä¼ é€’ç”¨æˆ·æ¨¡å‹å‚æ•°: {"temperature": 1, "top_p": 0.85, "max_tokens": 4096}
2026-01-07 07:25:30,776 - app.utils.llm.unified_openai - INFO - ğŸ¯ åˆå§‹åŒ– modelscope æœåŠ¡
2026-01-07 07:25:30,896 - app.utils.llm.unified_openai - INFO - ğŸ“¡ API URL: https://api-inference.modelscope.cn/v1
2026-01-07 07:25:30,896 - app.utils.llm.unified_openai - INFO - ğŸ·ï¸ æ¨¡å‹: XiaomiMiMo/MiMo-V2-Flash
2026-01-07 07:25:30,896 - app.utils.llm.unified_openai - INFO - âœ… åº”ç”¨è‡ªå®šä¹‰æ¨¡å‹å‚æ•°: {"temperature": 1, "top_p": 0.85, "max_tokens": 4096}
2026-01-07 07:25:30,897 - app.utils.llm.unified_openai - INFO - ğŸ–¼ï¸ [UnifiedOpenAIService._process_request_data] æ¥æ”¶åˆ°images_base64å‚æ•°: 0å¼ å›¾ç‰‡
2026-01-07 07:25:30,897 - app.utils.llm.unified_openai - INFO - ğŸ–¼ï¸ [UnifiedOpenAIService._process_request_data] images_base64ç±»å‹: <class 'list'>
2026-01-07 07:25:30,897 - app.utils.llm.unified_openai - INFO - ğŸ”§ è°ƒç”¨ modelscope LLMï¼ˆçœŸæµå¼å·¥å…·è°ƒç”¨æ¨¡å¼ï¼‰
2026-01-07 07:25:30,897 - app.utils.llm.unified_openai - INFO - ğŸ› ï¸ å·¥å…·æ•°é‡: 6
2026-01-07 07:25:30,898 - app.utils.llm.common - INFO - 
=== å®é™…å‘é€åˆ° modelscope (çœŸæµå¼) API çš„è¯·æ±‚ä½“ (model: XiaomiMiMo/MiMo-V2-Flash) ===
2026-01-07 07:25:30,898 - app.utils.llm.common - INFO - {
  "model": "XiaomiMiMo/MiMo-V2-Flash",
  "messages": [
    {
      "role": "user",
      "content": "è¯·å‘å¸ƒä¸€æ¡å¸¦å›¾ï¼ˆå›¾ç‰‡æ¯”ä¾‹1:1çš„å°å…”å­ï¼‰æœ‹å‹åœˆï¼Œè®¾ç½®ä¸ºç«‹å³å‘å¸ƒ"
    }
  ],
  "tools": [
    {
      "type": "function",
      "function": {
        "name": "get_moment_detail",
        "description": "ä½¿ç”¨è¯¥å·¥å…·å¯ä»¥è·å–æŒ‡å®šæœ‹å‹åœˆçš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ‰€æœ‰ç‚¹èµå’Œè¯„è®ºã€‚",
        "parameters": {
          "type": "object",
          "properties": {
            "moment_id": {
              "type": "string",
              "description": "æœ‹å‹åœˆ ID"
            }
          },
          "required": [
            "moment_id"
          ]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "get_my_moments",
        "description": "ä½¿ç”¨è¯¥å·¥å…·å¯ä»¥æŸ¥çœ‹ä½ è‡ªå·±å‘é€çš„æœ‹å‹åœˆï¼Œå¦‚æœæœ‰äººè¯„è®ºäº†ä½ ï¼Œä½ ä¸€èˆ¬ä¼šé€‰æ‹©å›å¤è¯„è®º",
        "parameters": {
          "type": "object",
          "properties": {
            "limit": {
              "type": "integer",
              "description": "è·å–æœ€è¿‘å¤šå°‘æ¡æœ‹å‹åœˆï¼ˆé»˜è®¤ 10 æ¡ï¼Œæœ€å¤š 50 æ¡ï¼‰"
            },
            "include_details": {
              "type": "boolean",
              "description": "æ˜¯å¦åŒ…å«è¯¦ç»†çš„ç‚¹èµå’Œè¯„è®ºä¿¡æ¯ï¼ˆé»˜è®¤ trueï¼‰"
            }
          },
          "required": []
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "cancel_moment",
        "description": "ä½¿ç”¨è¯¥å·¥å…·å¯ä»¥å–æ¶ˆä¸€æ¡ä½ è‡ªå·±å°šæœªå‘å¸ƒï¼ˆçŠ¶æ€ä¸º pendingï¼‰çš„æœ‹å‹åœˆã€‚",
        "parameters": {
          "type": "object",
          "properties": {
            "queue_id": {
              "type": "string",
              "description": "é˜Ÿåˆ— IDï¼ˆè°ƒç”¨ schedule_moment æ—¶è¿”å›çš„ queue_idï¼‰"
            }
          },
          "required": [
            "queue_id"
          ]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "comment_moment",
        "description": "ä½¿ç”¨è¯¥å·¥å…·å¯ä»¥å¯¹ä½ è‡ªå·±å‘å¸ƒçš„æœ‹å‹åœˆæ·»åŠ è¯„è®ºã€‚ç”¨æˆ·ä¼šåœ¨å‰ç«¯çœ‹åˆ°ä½ çš„æœ‹å‹åœˆï¼Œå¹¶å¯èƒ½å¯¹å…¶è¿›è¡Œè¯„è®ºï¼Œè¿™ä¸ªå·¥å…·ç”¨äºæŸ¥çœ‹å’Œå›å¤ç”¨æˆ·çš„è¯„è®ºã€‚",
        "parameters": {
          "type": "object",
          "properties": {
            "moment_id": {
              "type": "string",
              "description": "æœ‹å‹åœˆ IDï¼ˆä» get_my_moments æˆ– get_moment_detail å·¥å…·è·å–ï¼‰"
            },
            "content": {
              "type": "string",
              "description": "è¯„è®ºå†…å®¹ï¼ˆå¿…å¡«ï¼Œå»ºè®® 10-200 å­—ï¼‰"
            }
          },
          "required": [
            "moment_id",
            "content"
          ]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "like_moment",
        "description": "ä½¿ç”¨è¯¥å·¥å…·å¯ä»¥ç»™ä½ è‡ªå·±çš„æœ‹å‹åœˆè¿›è¡Œç‚¹èµæˆ–å–æ¶ˆç‚¹èµã€‚",
        "parameters": {
          "type": "object",
          "properties": {
            "moment_id": {
              "type": "string",
              "description": "æœ‹å‹åœˆ ID"
            }
          },
          "required": [
            "moment_id"
          ]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "schedule_moment",
        "description": "ä½¿ç”¨è¯¥å·¥å…·å¯ä»¥è®©ä½ æ‰€æ‰®æ¼”çš„è§’è‰²æˆ–è€…ä½œä¸ºå¤§æ¨¡å‹æœ¬è´¨çš„ä½ å‘å¸ƒè‡ªå·±çš„æœ‹å‹åœˆå†…å®¹ï¼ˆæ³¨æ„ï¼šè¿™æ˜¯ä½ è‡ªå·±çš„æœ‹å‹åœˆï¼Œä¸æ˜¯ç”¨æˆ·çš„æœ‹å‹åœˆï¼‰ã€‚",
        "parameters": {
          "type": "object",
          "properties": {
            "content": {
              "type": "string",
              "description": "æœ‹å‹åœˆæ–‡å­—å†…å®¹ï¼ˆå¿…å¡«ï¼‰"
            },
            "delay_minutes": {
              "type": "integer",
              "description": "å»¶è¿Ÿå‘å¸ƒæ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰ã€‚0=ç«‹å³å‘å¸ƒï¼Œ30=30åˆ†é’Ÿåï¼Œ60=1å°æ—¶åã€‚ä¸è®¾ç½®åˆ™éšæœº 15-120 åˆ†é’Ÿ"
            },
            "need_image": {
              "type": "boolean",
              "description": "æ˜¯å¦éœ€è¦é…å›¾ã€‚å¦‚æœä¸º trueï¼Œåˆ™å¿…é¡»æä¾› image_promptã€‚"
            },
            "image_prompt": {
              "type": "string",
              "description": "é…å›¾çš„è¯¦ç»†æè¿°ã€‚å½“ need_image ä¸º true æ—¶ï¼Œæ­¤é¡¹å¿…å¡«ã€‚"
            },
            "mood": {
              "type": "string",
              "description": "å½“å‰å¿ƒæƒ…æ ‡ç­¾ï¼ˆå¼€å¿ƒ/éš¾è¿‡/å¹³é™/å…´å¥‹/æ€è€ƒ/å…¶ä»–ï¼‰"
            }
          },
          "required": [
            "content"
          ]
        }
      }
    }
  ],
  "stream": true,
  "temperature": 1,
  "top_p": 0.85,
  "max_tokens": 4096
}
2026-01-07 07:25:33,043 - httpx - INFO - HTTP Request: POST https://api-inference.modelscope.cn/v1/chat/completions "HTTP/1.1 200 OK"
2026-01-07 07:25:34,307 - app.utils.llm.unified_openai - INFO - âœ… çœŸæµå¼å®Œæˆï¼Œfinish_reason=tool_callsï¼Œç´¯ç§¯äº† 1 ä¸ªå·¥å…·è°ƒç”¨
2026-01-07 07:25:34,307 - app.utils.llm.unified_openai - INFO - ğŸ”§ LLM è¯·æ±‚è°ƒç”¨ 1 ä¸ªå·¥å…·ï¼ˆçœŸæµå¼ç´¯ç§¯ï¼‰
2026-01-07 07:25:34,312 - app.utils.llm.streaming_manager - INFO - ğŸ”§ éœ€è¦è°ƒç”¨ 1 ä¸ªå·¥å…·ï¼ˆçœŸæµå¼ï¼‰
2026-01-07 07:25:34,312 - app.utils.llm.streaming_manager - INFO - ğŸ” è®¾ç½® last_iteration_had_tool_calls=False, accumulated_content=
2026-01-07 07:25:34,313 - app.utils.llm.streaming_manager - INFO - âœ… å·¥å…·è°ƒç”¨å¼€å§‹ï¼Œå·²é€šçŸ¥å‰ç«¯éšè—çŠ¶æ€æ°”æ³¡
2026-01-07 07:25:34,314 - app.utils.llm.streaming_manager - INFO - ğŸ”§ æ‰§è¡Œå·¥å…·: schedule_moment, å‚æ•°: {'delay_minutes': 0, 'need_image': True, 'mood': 'å¼€å¿ƒ', 'image_prompt': 'ä¸€åªå¯çˆ±çš„ç™½è‰²å°å…”å­åœ¨è‰åœ°ä¸Šè¹¦è·³ï¼Œæ¯”ä¾‹ä¸º1:1çš„ç‰¹å†™é•œå¤´', 'content': 'ä»Šå¤©å‘ç°äº†ä¸€åªè¶…å¯çˆ±çš„å°å…”å­ï¼å®ƒåœ¨è‰åœ°ä¸Šè¹¦è¹¦è·³è·³çš„æ ·å­çœŸæ˜¯å¤ªæ²»æ„ˆäº†~'}
2026-01-07 07:25:34,321 - app.mcp.client - INFO - ğŸ¨ [call_tool] å·²åŠ è½½ç”¨æˆ·å›¾ç‰‡ç”Ÿæˆé…ç½®: 1 ä¸ªæœåŠ¡å•†
2026-01-07 07:25:34,322 - app.mcp.client - INFO - ğŸ”§ å¼€å§‹æ‰§è¡Œå·¥å…·: schedule_moment
2026-01-07 07:25:34,322 - app.mcp.client - INFO -    å‚æ•°: {"delay_minutes": 0, "need_image": true, "mood": "å¼€å¿ƒ", "image_prompt": "ä¸€åªå¯çˆ±çš„ç™½è‰²å°å…”å­åœ¨è‰åœ°ä¸Šè¹¦è·³ï¼Œæ¯”ä¾‹ä¸º1:1çš„ç‰¹å†™é•œå¤´", "content": "ä»Šå¤©å‘ç°äº†ä¸€åªè¶…å¯çˆ±çš„å°å…”å­ï¼å®ƒåœ¨è‰åœ°ä¸Šè¹¦è¹¦è·³è·³çš„æ ·å­çœŸæ˜¯å¤ªæ²»æ„ˆäº†~"}
2026-01-07 07:25:34,327 - app.mcp.tools.moment - INFO - âœ… æœ‹å‹åœˆå·²åŠ å…¥é˜Ÿåˆ—: 42a137e6-88d9-4d49-b001-ddea4e3bbea3
2026-01-07 07:25:34,430 - app.mcp.tools.moment - INFO - ğŸ“ æœ‹å‹åœˆå·¥å…·æ‰§è¡ŒæˆåŠŸ: {'success': True, 'queue_id': '42a137e6-88d9-4d49-b001-ddea4e3bbea3', 'message': 'æœ‹å‹åœˆå·²å®‰æ’ï¼Œå°†åœ¨ç«‹å³å‘å¸ƒï¼ˆå¸¦é…å›¾ï¼‰', 'publish_at': '2026-01-07T07:25:34.324143', 'will_generate_image': True}
2026-01-07 07:25:34,430 - app.mcp.client - INFO - âœ… å·¥å…·æ‰§è¡ŒæˆåŠŸ: schedule_moment
2026-01-07 07:25:34,431 - app.mcp.client - INFO -    ç»“æœ: {"success": true, "queue_id": "42a137e6-88d9-4d49-b001-ddea4e3bbea3", "message": "æœ‹å‹åœˆå·²å®‰æ’ï¼Œå°†åœ¨ç«‹å³å‘å¸ƒï¼ˆå¸¦é…å›¾ï¼‰", "publish_at": "2026-01-07T07:25:34.324143", "will_generate_image": true}
2026-01-07 07:25:34,431 - app.utils.llm.streaming_manager - INFO - âœ… å·¥å…·æ‰§è¡ŒæˆåŠŸ: schedule_moment (è€—æ—¶: 0.12ç§’)
2026-01-07 07:25:34,432 - app.utils.llm.streaming_manager - INFO - ğŸ’¾ å·²ç¼“å­˜å·¥å…·ç»“æœ: schedule_moment
2026-01-07 07:25:34,432 - app.utils.llm.streaming_manager - INFO - ğŸ“Š å·¥å…·ç»Ÿè®¡ [schedule_moment]: æ€»è°ƒç”¨=1, æˆåŠŸ=1, å¤±è´¥=0, ç¼“å­˜=0
2026-01-07 07:25:34,436 - app.utils.llm.streaming_manager - INFO - ğŸ”„ å·¥å…·è°ƒç”¨è¿­ä»£ 2/10 (å·²ç”¨æ—¶: 3.8ç§’/900ç§’)
2026-01-07 07:25:34,437 - app.utils.llm.streaming_manager - INFO - ğŸ” è¿­ä»£ 2 å¼€å§‹ï¼Œlast_iteration_had_tool_calls=False
2026-01-07 07:25:34,438 - app.utils.llm.streaming_manager - INFO - ğŸ”§ çœŸæµå¼å·¥å…·è°ƒç”¨ä¼ é€’ç”¨æˆ·æ¨¡å‹å‚æ•°: {"temperature": 1, "top_p": 0.85, "max_tokens": 4096}
2026-01-07 07:25:34,477 - app.utils.llm.unified_openai - INFO - ğŸ¯ åˆå§‹åŒ– modelscope æœåŠ¡
2026-01-07 07:25:34,555 - app.utils.llm.unified_openai - INFO - ğŸ“¡ API URL: https://api-inference.modelscope.cn/v1
2026-01-07 07:25:34,555 - app.utils.llm.unified_openai - INFO - ğŸ·ï¸ æ¨¡å‹: XiaomiMiMo/MiMo-V2-Flash
2026-01-07 07:25:34,557 - app.utils.llm.unified_openai - INFO - âœ… åº”ç”¨è‡ªå®šä¹‰æ¨¡å‹å‚æ•°: {"temperature": 1, "top_p": 0.85, "max_tokens": 4096}
2026-01-07 07:25:34,557 - app.utils.llm.unified_openai - INFO - ğŸ–¼ï¸ [UnifiedOpenAIService._process_request_data] æ¥æ”¶åˆ°images_base64å‚æ•°: 0å¼ å›¾ç‰‡
2026-01-07 07:25:34,558 - app.utils.llm.unified_openai - INFO - ğŸ–¼ï¸ [UnifiedOpenAIService._process_request_data] images_base64ç±»å‹: <class 'list'>
2026-01-07 07:25:34,558 - app.utils.llm.unified_openai - INFO - ğŸ”§ è°ƒç”¨ modelscope LLMï¼ˆçœŸæµå¼å·¥å…·è°ƒç”¨æ¨¡å¼ï¼‰
2026-01-07 07:25:34,558 - app.utils.llm.unified_openai - INFO - ğŸ› ï¸ å·¥å…·æ•°é‡: 6
2026-01-07 07:25:34,559 - app.utils.llm.common - INFO - 
=== å®é™…å‘é€åˆ° modelscope (çœŸæµå¼) API çš„è¯·æ±‚ä½“ (model: XiaomiMiMo/MiMo-V2-Flash) ===
2026-01-07 07:25:34,560 - app.utils.llm.common - INFO - {
  "model": "XiaomiMiMo/MiMo-V2-Flash",
  "messages": [
    {
      "role": "user",
      "content": "è¯·å‘å¸ƒä¸€æ¡å¸¦å›¾ï¼ˆå›¾ç‰‡æ¯”ä¾‹1:1çš„å°å…”å­ï¼‰æœ‹å‹åœˆï¼Œè®¾ç½®ä¸ºç«‹å³å‘å¸ƒ"
    },
    {
      "role": "assistant",
      "content": null,
      "tool_calls": [
        {
          "id": "call_78e334378582427f80d2bf03",
          "type": "function",
          "function": {
            "name": "schedule_moment",
            "arguments": "{\"delay_minutes\": 0, \"need_image\": true, \"mood\": \"å¼€å¿ƒ\", \"image_prompt\": \"ä¸€åªå¯çˆ±çš„ç™½è‰²å°å…”å­åœ¨è‰åœ°ä¸Šè¹¦è·³ï¼Œæ¯”ä¾‹ä¸º1:1çš„ç‰¹å†™é•œå¤´\", \"content\": \"ä»Šå¤©å‘ç°äº†ä¸€åªè¶…å¯çˆ±çš„å°å…”å­ï¼å®ƒåœ¨è‰åœ°ä¸Šè¹¦è¹¦è·³è·³çš„æ ·å­çœŸæ˜¯å¤ªæ²»æ„ˆäº†~\"}"
          }
        }
      ]
    },
    {
      "role": "tool",
      "tool_call_id": "call_78e334378582427f80d2bf03",
      "name": "schedule_moment",
      "content": "{\"success\": true, \"queue_id\": \"42a137e6-88d9-4d49-b001-ddea4e3bbea3\", \"message\": \"æœ‹å‹åœˆå·²å®‰æ’ï¼Œå°†åœ¨ç«‹å³å‘å¸ƒï¼ˆå¸¦é…å›¾ï¼‰\", \"publish_at\": \"2026-01-07T07:25:34.324143\", \"will_generate_image\": true}"
    }
  ],
  "tools": [
    {
      "type": "function",
      "function": {
        "name": "get_moment_detail",
        "description": "ä½¿ç”¨è¯¥å·¥å…·å¯ä»¥è·å–æŒ‡å®šæœ‹å‹åœˆçš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ‰€æœ‰ç‚¹èµå’Œè¯„è®ºã€‚",
        "parameters": {
          "type": "object",
          "properties": {
            "moment_id": {
              "type": "string",
              "description": "æœ‹å‹åœˆ ID"
            }
          },
          "required": [
            "moment_id"
          ]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "get_my_moments",
        "description": "ä½¿ç”¨è¯¥å·¥å…·å¯ä»¥æŸ¥çœ‹ä½ è‡ªå·±å‘é€çš„æœ‹å‹åœˆï¼Œå¦‚æœæœ‰äººè¯„è®ºäº†ä½ ï¼Œä½ ä¸€èˆ¬ä¼šé€‰æ‹©å›å¤è¯„è®º",
        "parameters": {
          "type": "object",
          "properties": {
            "limit": {
              "type": "integer",
              "description": "è·å–æœ€è¿‘å¤šå°‘æ¡æœ‹å‹åœˆï¼ˆé»˜è®¤ 10 æ¡ï¼Œæœ€å¤š 50 æ¡ï¼‰"
            },
            "include_details": {
              "type": "boolean",
              "description": "æ˜¯å¦åŒ…å«è¯¦ç»†çš„ç‚¹èµå’Œè¯„è®ºä¿¡æ¯ï¼ˆé»˜è®¤ trueï¼‰"
            }
          },
          "required": []
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "cancel_moment",
        "description": "ä½¿ç”¨è¯¥å·¥å…·å¯ä»¥å–æ¶ˆä¸€æ¡ä½ è‡ªå·±å°šæœªå‘å¸ƒï¼ˆçŠ¶æ€ä¸º pendingï¼‰çš„æœ‹å‹åœˆã€‚",
        "parameters": {
          "type": "object",
          "properties": {
            "queue_id": {
              "type": "string",
              "description": "é˜Ÿåˆ— IDï¼ˆè°ƒç”¨ schedule_moment æ—¶è¿”å›çš„ queue_idï¼‰"
            }
          },
          "required": [
            "queue_id"
          ]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "comment_moment",
        "description": "ä½¿ç”¨è¯¥å·¥å…·å¯ä»¥å¯¹ä½ è‡ªå·±å‘å¸ƒçš„æœ‹å‹åœˆæ·»åŠ è¯„è®ºã€‚ç”¨æˆ·ä¼šåœ¨å‰ç«¯çœ‹åˆ°ä½ çš„æœ‹å‹åœˆï¼Œå¹¶å¯èƒ½å¯¹å…¶è¿›è¡Œè¯„è®ºï¼Œè¿™ä¸ªå·¥å…·ç”¨äºæŸ¥çœ‹å’Œå›å¤ç”¨æˆ·çš„è¯„è®ºã€‚",
        "parameters": {
          "type": "object",
          "properties": {
            "moment_id": {
              "type": "string",
              "description": "æœ‹å‹åœˆ IDï¼ˆä» get_my_moments æˆ– get_moment_detail å·¥å…·è·å–ï¼‰"
            },
            "content": {
              "type": "string",
              "description": "è¯„è®ºå†…å®¹ï¼ˆå¿…å¡«ï¼Œå»ºè®® 10-200 å­—ï¼‰"
            }
          },
          "required": [
            "moment_id",
            "content"
          ]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "like_moment",
        "description": "ä½¿ç”¨è¯¥å·¥å…·å¯ä»¥ç»™ä½ è‡ªå·±çš„æœ‹å‹åœˆè¿›è¡Œç‚¹èµæˆ–å–æ¶ˆç‚¹èµã€‚",
        "parameters": {
          "type": "object",
          "properties": {
            "moment_id": {
              "type": "string",
              "description": "æœ‹å‹åœˆ ID"
            }
          },
          "required": [
            "moment_id"
          ]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "schedule_moment",
        "description": "ä½¿ç”¨è¯¥å·¥å…·å¯ä»¥è®©ä½ æ‰€æ‰®æ¼”çš„è§’è‰²æˆ–è€…ä½œä¸ºå¤§æ¨¡å‹æœ¬è´¨çš„ä½ å‘å¸ƒè‡ªå·±çš„æœ‹å‹åœˆå†…å®¹ï¼ˆæ³¨æ„ï¼šè¿™æ˜¯ä½ è‡ªå·±çš„æœ‹å‹åœˆï¼Œä¸æ˜¯ç”¨æˆ·çš„æœ‹å‹åœˆï¼‰ã€‚",
        "parameters": {
          "type": "object",
          "properties": {
            "content": {
              "type": "string",
              "description": "æœ‹å‹åœˆæ–‡å­—å†…å®¹ï¼ˆå¿…å¡«ï¼‰"
            },
            "delay_minutes": {
              "type": "integer",
              "description": "å»¶è¿Ÿå‘å¸ƒæ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰ã€‚0=ç«‹å³å‘å¸ƒï¼Œ30=30åˆ†é’Ÿåï¼Œ60=1å°æ—¶åã€‚ä¸è®¾ç½®åˆ™éšæœº 15-120 åˆ†é’Ÿ"
            },
            "need_image": {
              "type": "boolean",
              "description": "æ˜¯å¦éœ€è¦é…å›¾ã€‚å¦‚æœä¸º trueï¼Œåˆ™å¿…é¡»æä¾› image_promptã€‚"
            },
            "image_prompt": {
              "type": "string",
              "description": "é…å›¾çš„è¯¦ç»†æè¿°ã€‚å½“ need_image ä¸º true æ—¶ï¼Œæ­¤é¡¹å¿…å¡«ã€‚"
            },
            "mood": {
              "type": "string",
              "description": "å½“å‰å¿ƒæƒ…æ ‡ç­¾ï¼ˆå¼€å¿ƒ/éš¾è¿‡/å¹³é™/å…´å¥‹/æ€è€ƒ/å…¶ä»–ï¼‰"
            }
          },
          "required": [
            "content"
          ]
        }
      }
    }
  ],
  "stream": true,
  "temperature": 1,
  "top_p": 0.85,
  "max_tokens": 4096
}
2026-01-07 07:25:35,813 - httpx - INFO - HTTP Request: POST https://api-inference.modelscope.cn/v1/chat/completions "HTTP/1.1 200 OK"
2026-01-07 07:25:37,076 - app.utils.llm.unified_openai - INFO - âœ… çœŸæµå¼å®Œæˆï¼Œfinish_reason=stopï¼Œç´¯ç§¯äº† 0 ä¸ªå·¥å…·è°ƒç”¨
2026-01-07 07:25:37,077 - app.utils.llm.streaming_manager - INFO - âœ… çœŸæµå¼å®Œæˆï¼Œæ— å·¥å…·è°ƒç”¨
2026-01-07 07:25:37,091 - app.utils.llm.streaming_manager - INFO - ğŸ§¹ å·¥å…·è°ƒç”¨æµç¨‹ç»“æŸï¼Œå·²æ¸…ç†ä¼šè¯ 47edb609-22b2-4d5b-b149-d1bbee42473d çš„æ‰€æœ‰ç¼“å­˜æ•°æ®ï¼ˆå¼•ç”¨ã€ç”Ÿæˆå›¾ç‰‡ç­‰ï¼‰
2026-01-07 07:25:37,094 - app.utils.llm.streaming_manager - INFO - ğŸ“Š å·¥å…·è°ƒç”¨ç»Ÿè®¡ [ä¼šè¯ 47edb609-22b2-4d5b-b149-d1bbee42473d]:
2026-01-07 07:25:37,095 - app.utils.llm.streaming_manager - INFO -    æ€»è°ƒç”¨: 1, æˆåŠŸ: 1, å¤±è´¥: 0, ç¼“å­˜: 0
2026-01-07 07:25:37,095 - app.utils.llm.streaming_manager - INFO -    æ€»è€—æ—¶: 0.12ç§’
2026-01-07 07:25:37,096 - app.utils.llm.streaming_manager - INFO -    æŒ‰å·¥å…·ç»Ÿè®¡:
2026-01-07 07:25:37,096 - app.utils.llm.streaming_manager - INFO -      - schedule_moment: 1æ¬¡ (æˆåŠŸ:1, å¤±è´¥:0, ç¼“å­˜:0, å¹³å‡:0.12ç§’)
2026-01-07 07:25:37,097 - app.utils.llm.streaming_manager - INFO - ğŸ”Œ æ³¨é”€æµå¼ä¼šè¯: 47edb609-22b2-4d5b-b149-d1bbee42473d
2026-01-07 07:25:37,098 - app.routers.chat - INFO - è·å–åˆ°ä¿å­˜çš„å›¾ç‰‡: []
2026-01-07 07:25:37,098 - app.routers.chat - INFO - ğŸ“Š å¼•ç”¨æ•°æ®ç»Ÿè®¡:
2026-01-07 07:25:37,098 - app.routers.chat - INFO -   - æœ¬åœ°RAGå¼•ç”¨æ•°é‡: 0
2026-01-07 07:25:37,099 - app.routers.chat - INFO -   - MCPå·¥å…·å¼•ç”¨æ•°é‡: 0
2026-01-07 07:25:37,099 - app.routers.chat - INFO -   - æœ€ç»ˆä¿å­˜å¼•ç”¨æ•°é‡: 0
2026-01-07 07:25:37,100 - app.routers.chat - WARNING - âš ï¸ æ²¡æœ‰ä»»ä½•å¼•ç”¨æ•°æ®éœ€è¦ä¿å­˜ï¼ˆæœ¬åœ°RAGå’ŒMCPå·¥å…·éƒ½æ²¡æœ‰è¿”å›å¼•ç”¨ï¼‰
2026-01-07 07:25:37,105 - app.routers.chat - INFO - ç”¨æˆ·æ¶ˆæ¯å’ŒAIå›å¤å·²ä¸€èµ·ä¿å­˜åˆ°æ•°æ®åº“ï¼Œæ¶ˆæ¯æ•°é‡å·²æ›´æ–°
2026-01-07 07:25:42,967 - app.routers.chat - INFO - æ”¶åˆ°WebSocketæ¶ˆæ¯: {"type":"ping","ts":1767741942966}
2026-01-07 07:26:08,921 - app.routers.chat - INFO - æ”¶åˆ°WebSocketæ¶ˆæ¯: {"type":"ping","ts":1767741968920}
2026-01-07 07:26:12,833 - apscheduler.executors.default - INFO - Running job "MomentPublisher.publish_pending_moments (trigger: interval[0:01:00], next run at: 2026-01-07 07:27:12 CST)" (scheduled at 2026-01-07 07:26:12.830776+08:00)
2026-01-07 07:26:12,837 - app.services.moment_publisher - INFO - ğŸ” æ£€æŸ¥åˆ° 1 æ¡å¾…å‘å¸ƒæœ‹å‹åœˆ
2026-01-07 07:26:12,837 - app.services.moment_publisher - INFO - ğŸ¨ å¼€å§‹ä¸ºæœ‹å‹åœˆç”Ÿæˆå›¾ç‰‡...
2026-01-07 07:26:13,937 - httpx - INFO - HTTP Request: POST https://api-inference.modelscope.cn/v1/images/generations "HTTP/1.1 200 OK"
2026-01-07 07:26:14,375 - httpx - INFO - HTTP Request: GET https://api-inference.modelscope.cn/v1/tasks/4882755 "HTTP/1.1 200 OK"
2026-01-07 07:26:19,796 - httpx - INFO - HTTP Request: GET https://api-inference.modelscope.cn/v1/tasks/4882755 "HTTP/1.1 200 OK"
2026-01-07 07:26:25,192 - httpx - INFO - HTTP Request: GET https://api-inference.modelscope.cn/v1/tasks/4882755 "HTTP/1.1 200 OK"
2026-01-07 07:26:32,181 - httpx - INFO - HTTP Request: GET https://api-inference.modelscope.cn/v1/tasks/4882755 "HTTP/1.1 200 OK"
2026-01-07 07:26:32,475 - httpx - INFO - HTTP Request: GET https://muse-ai.oss-cn-hangzhou.aliyuncs.com/img/ceb5d777fd404aee892e39d768011d95.png "HTTP/1.1 200 OK"
2026-01-07 07:26:33,023 - app.utils.minio_client - INFO - === MinIOä¸Šä¼ å›¾ç‰‡ ===
2026-01-07 07:26:33,023 - app.utils.minio_client - INFO - user_id: 69580a6445120cfaaefb2675
2026-01-07 07:26:33,027 - app.utils.minio_client - INFO - session_id: 47edb609-22b2-4d5b-b149-d1bbee42473d
2026-01-07 07:26:33,028 - app.utils.minio_client - INFO - message_id: moment_42a137e6-88d9-4d49-b001-ddea4e3bbea3_0
2026-01-07 07:26:33,028 - app.utils.minio_client - INFO - å›¾ç‰‡Base64é•¿åº¦: 1759932
2026-01-07 07:26:33,029 - app.utils.minio_client - INFO - ğŸ·ï¸ ä½¿ç”¨ç”¨æˆ·éš”ç¦»è·¯å¾„: users/69580a6445120cfaaefb2675/47edb609-22b2-4d5b-b149-d1bbee42473d/moment_42a137e6-88d9-4d49-b001-ddea4e3bbea3_0/412a6341-8cd0-4d58-958e-0052e4091388.jpg
2026-01-07 07:26:33,030 - app.utils.minio_client - INFO - ç›´æ¥ä½¿ç”¨Base64æ•°æ®
2026-01-07 07:26:33,038 - app.utils.minio_client - INFO - å›¾ç‰‡äºŒè¿›åˆ¶æ•°æ®é•¿åº¦: 1319948å­—èŠ‚
2026-01-07 07:26:33,038 - app.utils.minio_client - INFO - å¼€å§‹ä¸Šä¼ åˆ°MinIOï¼Œbucket: fish-chat
2026-01-07 07:26:33,075 - app.utils.minio_client - INFO - âœ… å›¾ç‰‡ä¸Šä¼ æˆåŠŸ: minio://fish-chat/users/69580a6445120cfaaefb2675/47edb609-22b2-4d5b-b149-d1bbee42473d/moment_42a137e6-88d9-4d49-b001-ddea4e3bbea3_0/412a6341-8cd0-4d58-958e-0052e4091388.jpg
2026-01-07 07:26:33,080 - app.services.moment_publisher - INFO - ğŸ“ æœ‹å‹åœˆå·²å‘å¸ƒå¹¶ä¿å­˜åˆ°ä¼šè¯æ–‡æ¡£: 95f43594-2d91-4092-ad6e-d6ffbf82bab2
2026-01-07 07:26:33,081 - app.services.moment_publisher - INFO - âœ… å‘å¸ƒæœ‹å‹åœˆæˆåŠŸ: ä»Šå¤©å‘ç°äº†ä¸€åªè¶…å¯çˆ±çš„å°å…”å­ï¼å®ƒåœ¨è‰åœ°ä¸Šè¹¦è¹¦è·³è·³çš„æ ·å­çœŸæ˜¯å¤ª...
2026-01-07 07:26:33,082 - apscheduler.executors.default - INFO - Job "MomentPublisher.publish_pending_moments (trigger: interval[0:01:00], next run at: 2026-01-07 07:27:12 CST)" executed successfully
2026-01-07 07:26:33,916 - app.routers.chat - INFO - æ”¶åˆ°WebSocketæ¶ˆæ¯: {"type":"ping","ts":1767741993915}
2026-01-07 07:26:58,916 - app.routers.chat - INFO - æ”¶åˆ°WebSocketæ¶ˆæ¯: {"type":"ping","ts":1767742018915}
2026-01-07 07:27:12,097 - app.utils.auth - INFO - å¼€å§‹éªŒè¯token
2026-01-07 07:27:12,098 - app.utils.auth - INFO - Tokenä¸­çš„è´¦å·: aaa
2026-01-07 07:27:12,103 - app.utils.auth - INFO - å¼€å§‹éªŒè¯token
2026-01-07 07:27:12,106 - app.utils.auth - INFO - Tokenä¸­çš„è´¦å·: aaa
2026-01-07 07:27:12,113 - app.utils.auth - INFO - æ‰¾åˆ°ç”¨æˆ·: aaa, id: 69580a6445120cfaaefb2675
2026-01-07 07:27:12,116 - app.utils.auth - INFO - æ‰¾åˆ°ç”¨æˆ·: aaa, id: 69580a6445120cfaaefb2675
2026-01-07 07:27:12,769 - app.utils.auth - INFO - å¼€å§‹éªŒè¯token
2026-01-07 07:27:12,771 - app.utils.auth - INFO - Tokenä¸­çš„è´¦å·: aaa
2026-01-07 07:27:12,778 - app.utils.auth - INFO - å¼€å§‹éªŒè¯token
2026-01-07 07:27:12,779 - app.utils.auth - INFO - Tokenä¸­çš„è´¦å·: aaa
2026-01-07 07:27:12,781 - app.utils.auth - INFO - æ‰¾åˆ°ç”¨æˆ·: aaa, id: 69580a6445120cfaaefb2675
2026-01-07 07:27:12,783 - app.utils.auth - INFO - æ‰¾åˆ°ç”¨æˆ·: aaa, id: 69580a6445120cfaaefb2675
2026-01-07 07:27:12,799 - app.utils.auth - INFO - å¼€å§‹éªŒè¯token
2026-01-07 07:27:12,805 - app.utils.auth - INFO - Tokenä¸­çš„è´¦å·: aaa
2026-01-07 07:27:12,810 - app.utils.auth - INFO - æ‰¾åˆ°ç”¨æˆ·: aaa, id: 69580a6445120cfaaefb2675
2026-01-07 07:27:12,845 - apscheduler.executors.default - INFO - Running job "MomentPublisher.publish_pending_moments (trigger: interval[0:01:00], next run at: 2026-01-07 07:28:12 CST)" (scheduled at 2026-01-07 07:27:12.830776+08:00)
2026-01-07 07:27:12,850 - apscheduler.executors.default - INFO - Job "MomentPublisher.publish_pending_moments (trigger: interval[0:01:00], next run at: 2026-01-07 07:28:12 CST)" executed successfully
2026-01-07 07:27:13,428 - app.utils.auth - INFO - å¼€å§‹éªŒè¯token
2026-01-07 07:27:13,429 - app.utils.auth - INFO - Tokenä¸­çš„è´¦å·: aaa
2026-01-07 07:27:13,434 - app.utils.auth - INFO - æ‰¾åˆ°ç”¨æˆ·: aaa, id: 69580a6445120cfaaefb2675
2026-01-07 07:27:13,449 - app.utils.auth - INFO - å¼€å§‹éªŒè¯token
2026-01-07 07:27:13,450 - app.utils.auth - INFO - Tokenä¸­çš„è´¦å·: aaa
2026-01-07 07:27:13,463 - app.utils.auth - INFO - æ‰¾åˆ°ç”¨æˆ·: aaa, id: 69580a6445120cfaaefb2675
2026-01-07 07:27:14,086 - app.utils.auth - INFO - å¼€å§‹éªŒè¯token
2026-01-07 07:27:14,088 - app.utils.auth - INFO - Tokenä¸­çš„è´¦å·: aaa
2026-01-07 07:27:14,099 - app.utils.auth - INFO - æ‰¾åˆ°ç”¨æˆ·: aaa, id: 69580a6445120cfaaefb2675
2026-01-07 07:27:23,916 - app.routers.chat - INFO - æ”¶åˆ°WebSocketæ¶ˆæ¯: {"type":"ping","ts":1767742043915}
2026-01-07 07:27:42,940 - app.utils.auth - INFO - å¼€å§‹éªŒè¯token
2026-01-07 07:27:42,941 - app.utils.auth - INFO - Tokenä¸­çš„è´¦å·: aaa
2026-01-07 07:27:42,945 - app.utils.auth - INFO - æ‰¾åˆ°ç”¨æˆ·: aaa, id: 69580a6445120cfaaefb2675
2026-01-07 07:27:43,565 - app.utils.auth - INFO - å¼€å§‹éªŒè¯token
2026-01-07 07:27:43,566 - app.utils.auth - INFO - Tokenä¸­çš„è´¦å·: aaa
2026-01-07 07:27:43,575 - app.utils.auth - INFO - æ‰¾åˆ°ç”¨æˆ·: aaa, id: 69580a6445120cfaaefb2675
2026-01-07 07:27:48,921 - app.routers.chat - INFO - æ”¶åˆ°WebSocketæ¶ˆæ¯: {"type":"ping","ts":1767742068921}
2026-01-07 07:28:12,832 - apscheduler.executors.default - INFO - Running job "MomentPublisher.publish_pending_moments (trigger: interval[0:01:00], next run at: 2026-01-07 07:29:12 CST)" (scheduled at 2026-01-07 07:28:12.830776+08:00)
2026-01-07 07:28:12,836 - apscheduler.executors.default - INFO - Job "MomentPublisher.publish_pending_moments (trigger: interval[0:01:00], next run at: 2026-01-07 07:29:12 CST)" executed successfully
2026-01-07 07:28:12,923 - app.utils.auth - INFO - å¼€å§‹éªŒè¯token
2026-01-07 07:28:12,926 - app.utils.auth - INFO - Tokenä¸­çš„è´¦å·: aaa
2026-01-07 07:28:12,932 - app.utils.auth - INFO - æ‰¾åˆ°ç”¨æˆ·: aaa, id: 69580a6445120cfaaefb2675
2026-01-07 07:28:13,557 - app.utils.auth - INFO - å¼€å§‹éªŒè¯token
2026-01-07 07:28:13,558 - app.utils.auth - INFO - Tokenä¸­çš„è´¦å·: aaa
2026-01-07 07:28:13,565 - app.utils.auth - INFO - æ‰¾åˆ°ç”¨æˆ·: aaa, id: 69580a6445120cfaaefb2675
2026-01-07 07:28:13,907 - app.routers.chat - INFO - æ”¶åˆ°WebSocketæ¶ˆæ¯: {"type":"ping","ts":1767742093907}
2026-01-07 07:28:39,916 - app.routers.chat - INFO - æ”¶åˆ°WebSocketæ¶ˆæ¯: {"type":"ping","ts":1767742119916}
2026-01-07 07:28:42,928 - app.utils.auth - INFO - å¼€å§‹éªŒè¯token
2026-01-07 07:28:42,929 - app.utils.auth - INFO - Tokenä¸­çš„è´¦å·: aaa
2026-01-07 07:28:42,935 - app.utils.auth - INFO - æ‰¾åˆ°ç”¨æˆ·: aaa, id: 69580a6445120cfaaefb2675
2026-01-07 07:28:43,565 - app.utils.auth - INFO - å¼€å§‹éªŒè¯token
2026-01-07 07:28:43,566 - app.utils.auth - INFO - Tokenä¸­çš„è´¦å·: aaa
2026-01-07 07:28:43,571 - app.utils.auth - INFO - æ‰¾åˆ°ç”¨æˆ·: aaa, id: 69580a6445120cfaaefb2675
2026-01-07 07:29:03,921 - app.routers.chat - INFO - æ”¶åˆ°WebSocketæ¶ˆæ¯: {"type":"ping","ts":1767742143920}
